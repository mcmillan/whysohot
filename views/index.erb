<!doctype html>
<html>
  <head>
    <title>Why is it so hot in here?</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
      * {
        padding: 0;
        margin: 0;
      }

      body {
        font: 14px 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
        -webkit-font-smoothing: antialiased;
        letter-spacing: 1px;
        color: #fff;
      }

      .container {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        transform: translate(0, -50%);
        text-align: center;
      }

      .currently {
        font-size: 100px;
        letter-spacing: 5px;
        margin-bottom: 20px;
      }

      .previously {
        width: 460px;
        margin: 14px auto 0;
        padding: 0 20px;
        text-align: left;
        display: none;
      }

      .previously .temperature {
        font-weight: bold;
      }

      .previously .timestamp {
        float: right;
      }

      @media screen and (max-width: 500px) {
        .previously {
          width: auto;
        }
      }

      @media screen and (max-height: 400px) {
        .container {
          position: relative;
          top: 0;
          transform: none;
          padding-top: 20px;
        }
      }

      svg {
        font: 10px sans-serif;
        opacity: 0.33;
      }

      .line {
        fill: none;
        stroke: #fff;
        stroke-width: 1.5px;
      }

      .area {
        fill: #fff;
        opacity: 0.33;
        stroke-width: 0;
      }

      .axis path,
      .axis line {
        fill: none;
        stroke: #fff;
        shape-rendering: crispEdges;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="currently" data-temperature="<%= @readings.first.temperature %>" data-taken-at="<%= @readings.first.taken_at.strftime('%H:%M') %>">
        <%= @readings.first.temperature %>&deg;C
      </div>

      <!-- <div>Previously:</div> -->

      <% @readings[0..4].each do |reading| %>
        <div class="previously">
          <div class="timestamp"><%= reading.taken_at.strftime('%H:%M') %></div>
          <div class="temperature"><%= reading.temperature %>&deg;C</div>
        </div>
      <% end %>
    </div>

    <script src="//js.pusher.com/2.2/pusher.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="/graph.js"></script>
    <script src="/app.js"></script>
    <script type="text/javascript">
      Graph.init(<%= @readings.reverse.to_json %>);
      var pusher = new Pusher('<%= ENV['PUSHER_KEY'] %>');
      var channel = pusher.subscribe('readings');
      channel.bind('new', addTemperature);
    </script>
  </body>
</html>
